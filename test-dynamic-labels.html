<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•çš„ãƒ©ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-section { 
            border: 2px solid #3B82F6; 
            margin: 20px; 
            padding: 20px; 
            border-radius: 8px; 
        }
    </style>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ğŸ§ª å‹•çš„ãƒ©ãƒ™ãƒ«æ›´æ–°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="test-section">
            <h2 class="text-xl font-bold mb-4">ç¾åœ¨ã®ãƒã‚¹ã‚¿ãƒ¼è¨­å®šå€¤</h2>
            <div id="masterDataDisplay" class="bg-yellow-50 p-4 rounded">
                <p>ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>

        <div class="test-section">
            <h2 class="text-xl font-bold mb-4">Step4ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ©ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆ</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-blue-900 mb-2">
                        <i class="fas fa-user-tie mr-2"></i>
                        ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ãƒ¼ï¼ˆ<span id="rate-display-supervisor">40,000</span>å††/æ—¥ï¼‰
                    </label>
                    <input type="number" id="rate_supervisor" class="form-input w-full" min="0" step="1000" />
                </div>

                <div class="bg-green-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-green-900 mb-2">
                        <i class="fas fa-user-cog mr-2"></i>
                        ãƒªãƒ¼ãƒ€ãƒ¼ä»¥ä¸Šï¼ˆ<span id="rate-display-leader">12,000</span>å††/æ—¥ï¼‰
                    </label>
                    <input type="number" id="rate_leader" class="form-input w-full" min="0" step="1000" />
                </div>

                <div class="bg-yellow-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-yellow-900 mb-2">
                        <i class="fas fa-user mr-2"></i>
                        M2ã‚¹ã‚¿ãƒƒãƒ•åŠæ—¥ï¼ˆ<span id="rate-display-m2-half">6,000</span>å††/åŠæ—¥ï¼‰
                    </label>
                    <input type="number" id="rate_m2_half_day" class="form-input w-full" min="0" step="500" />
                </div>

                <div class="bg-yellow-50 p-4 rounded-lg">
                    <label class="block text-sm font-medium text-yellow-900 mb-2">
                        <i class="fas fa-user mr-2"></i>
                        M2ã‚¹ã‚¿ãƒƒãƒ•çµ‚æ—¥ï¼ˆ<span id="rate-display-m2-full">10,000</span>å††/æ—¥ï¼‰
                    </label>
                    <input type="number" id="rate_m2_full_day" class="form-input w-full" min="0" step="1000" />
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2 class="text-xl font-bold mb-4">ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³</h2>
            <div class="space-x-4">
                <button onclick="testMasterDataFetch()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
                </button>
                <button onclick="testLabelUpdate()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    ãƒ©ãƒ™ãƒ«æ›´æ–°ãƒ†ã‚¹ãƒˆ
                </button>
                <button onclick="simulateStep4Init()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    Step4åˆæœŸåŒ–ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                </button>
            </div>
        </div>

        <div class="test-section">
            <h2 class="text-xl font-bold mb-4">ãƒ†ã‚¹ãƒˆçµæœ</h2>
            <div id="testResults" class="bg-gray-50 p-4 rounded min-h-20">
                <p class="text-gray-600">ãƒ†ã‚¹ãƒˆãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        // ãƒ†ã‚¹ãƒˆç”¨ã®é–¢æ•°ç¾¤
        
        async function testMasterDataFetch() {
            const resultsDiv = document.getElementById('testResults');
            const masterDiv = document.getElementById('masterDataDisplay');
            
            try {
                resultsDiv.innerHTML = '<p class="text-blue-600">ğŸ”„ ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...</p>';
                
                const response = await axios.get('/api/master-settings');
                
                if (response.data.success && response.data.data && response.data.data.staff_rates) {
                    const staffRates = response.data.data.staff_rates;
                    
                    masterDiv.innerHTML = `
                        <h3 class="font-bold mb-2">ğŸ“Š å–å¾—ã—ãŸãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿:</h3>
                        <ul class="space-y-1 text-sm">
                            <li>â€¢ ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒã‚¤ã‚¶ãƒ¼: ${staffRates.supervisor?.toLocaleString()}å††/æ—¥</li>
                            <li>â€¢ ãƒªãƒ¼ãƒ€ãƒ¼ä»¥ä¸Š: ${staffRates.leader?.toLocaleString()}å††/æ—¥</li>
                            <li>â€¢ M2ã‚¹ã‚¿ãƒƒãƒ•åŠæ—¥: ${staffRates.m2_half_day?.toLocaleString()}å††/åŠæ—¥</li>
                            <li>â€¢ M2ã‚¹ã‚¿ãƒƒãƒ•çµ‚æ—¥: ${staffRates.m2_full_day?.toLocaleString()}å††/æ—¥</li>
                            <li>â€¢ æ´¾é£ã‚¹ã‚¿ãƒƒãƒ•åŠæ—¥: ${staffRates.temp_half_day?.toLocaleString()}å††/åŠæ—¥</li>
                            <li>â€¢ æ´¾é£ã‚¹ã‚¿ãƒƒãƒ•çµ‚æ—¥: ${staffRates.temp_full_day?.toLocaleString()}å††/æ—¥</li>
                        </ul>
                    `;
                    
                    resultsDiv.innerHTML = '<p class="text-green-600">âœ… ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸï¼</p>';
                    return staffRates;
                } else {
                    throw new Error('ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="text-red-600">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
                console.error('ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        async function testLabelUpdate() {
            const resultsDiv = document.getElementById('testResults');
            
            try {
                resultsDiv.innerHTML = '<p class="text-blue-600">ğŸ”„ ãƒ©ãƒ™ãƒ«æ›´æ–°ã‚’ãƒ†ã‚¹ãƒˆä¸­...</p>';
                
                const staffRates = await testMasterDataFetch();
                
                if (staffRates) {
                    // ãƒ©ãƒ™ãƒ«æ›´æ–°å‡¦ç†ï¼ˆStep4Implementation.setMasterRatesToInputFields ã®ãƒ­ã‚¸ãƒƒã‚¯ã¨åŒã˜ï¼‰
                    const rateFields = [
                        { id: 'rate_supervisor', value: staffRates.supervisor || 40000, displayId: 'rate-display-supervisor' },
                        { id: 'rate_leader', value: staffRates.leader || 12000, displayId: 'rate-display-leader' },
                        { id: 'rate_m2_half_day', value: staffRates.m2_half_day || 6000, displayId: 'rate-display-m2-half' },
                        { id: 'rate_m2_full_day', value: staffRates.m2_full_day || 10000, displayId: 'rate-display-m2-full' }
                    ];

                    let updateCount = 0;
                    rateFields.forEach(field => {
                        // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¨­å®š
                        const inputElement = document.getElementById(field.id);
                        if (inputElement) {
                            inputElement.value = field.value;
                            updateCount++;
                        }
                        
                        // ãƒ©ãƒ™ãƒ«è¡¨ç¤ºã‚‚æ›´æ–°
                        const displayElement = document.getElementById(field.displayId);
                        if (displayElement) {
                            displayElement.textContent = field.value.toLocaleString();
                            updateCount++;
                            console.log(`âœ… ${field.displayId}: ${field.value.toLocaleString()}å†† è¡¨ç¤ºæ›´æ–°å®Œäº†`);
                        }
                    });

                    resultsDiv.innerHTML = `<p class="text-green-600">âœ… ãƒ©ãƒ™ãƒ«æ›´æ–°æˆåŠŸï¼ ${updateCount}å€‹ã®è¦ç´ ã‚’æ›´æ–°ã—ã¾ã—ãŸ</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="text-red-600">âŒ ãƒ©ãƒ™ãƒ«æ›´æ–°ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
                console.error('ãƒ©ãƒ™ãƒ«æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        async function simulateStep4Init() {
            const resultsDiv = document.getElementById('testResults');
            
            resultsDiv.innerHTML = '<p class="text-blue-600">ğŸ”„ Step4åˆæœŸåŒ–ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆä¸­...</p>';
            
            // Step4Implementation.setMasterRatesToInputFields ã®å®Œå…¨ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ†ã‚¹ãƒˆ
            try {
                console.log('ğŸ”„ Step4: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼†ãƒ©ãƒ™ãƒ«è¡¨ç¤ºã«è‡ªå‹•è¨­å®šé–‹å§‹');
                
                const masterResponse = await axios.get('/api/master-settings');
                
                if (masterResponse.data.success && masterResponse.data.data && masterResponse.data.data.staff_rates) {
                    const masterStaffRates = masterResponse.data.data.staff_rates;
                    
                    const rateFields = [
                        { id: 'rate_supervisor', value: masterStaffRates.supervisor || 40000, displayId: 'rate-display-supervisor' },
                        { id: 'rate_leader', value: masterStaffRates.leader || 12000, displayId: 'rate-display-leader' },
                        { id: 'rate_m2_half_day', value: masterStaffRates.m2_half_day || 6000, displayId: 'rate-display-m2-half' },
                        { id: 'rate_m2_full_day', value: masterStaffRates.m2_full_day || 10000, displayId: 'rate-display-m2-full' }
                    ];

                    rateFields.forEach(field => {
                        // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¨­å®š
                        const inputElement = document.getElementById(field.id);
                        if (inputElement) {
                            inputElement.value = field.value;
                            console.log(`âœ… ${field.id}: ${field.value}å†† è¨­å®šå®Œäº†`);
                        } else {
                            console.warn(`âš ï¸ ${field.id} è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                        }
                        
                        // ãƒ©ãƒ™ãƒ«è¡¨ç¤ºã‚‚æ›´æ–°
                        const displayElement = document.getElementById(field.displayId);
                        if (displayElement) {
                            displayElement.textContent = field.value.toLocaleString();
                            console.log(`âœ… ${field.displayId}: ${field.value.toLocaleString()}å†† è¡¨ç¤ºæ›´æ–°å®Œäº†`);
                        } else {
                            console.warn(`âš ï¸ ${field.displayId} è¡¨ç¤ºè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
                        }
                    });

                    console.log('âœ… Step4: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼†ãƒ©ãƒ™ãƒ«è¡¨ç¤ºè‡ªå‹•è¨­å®šå®Œäº†');
                    resultsDiv.innerHTML = '<p class="text-green-600">âœ… Step4åˆæœŸåŒ–ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆæˆåŠŸï¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„</p>';
                } else {
                    throw new Error('ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('âŒ Step4: ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿è‡ªå‹•è¨­å®šã‚¨ãƒ©ãƒ¼:', error);
                resultsDiv.innerHTML = `<p class="text-red-600">âŒ Step4åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è‡ªå‹•ãƒ†ã‚¹ãƒˆ
        window.addEventListener('load', () => {
            console.log('ğŸ§ª å‹•çš„ãƒ©ãƒ™ãƒ«ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†');
            testMasterDataFetch();
        });
    </script>
</body>
</html>